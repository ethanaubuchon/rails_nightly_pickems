<h1>Listing scores</h1>

<%= render partial: "shared/datepicker", locals: {date: @date, path: @path} %>

<table>
  <thead>
    <tr>
      <th>Home Team</th>
      <th>Home Score</th>
      <th>Away Team</th>
      <th>Away Score</th>
      <th colspan="2"></th>
    </tr>
  </thead>

  <tbody>
    <% @games.each do |game| %>
      <tr id="score-<%=game.id%>">
        <td>
          <%= game.home_team.city %>
          <%= game.home_team.name %>
        </td>
        <td>
          <input class="home-score" type="number" value='<%= (game.score) ? game.score.home : 0 %>'/>
        </td>
        <td>
          <%= game.away_team.city %>
          <%= game.away_team.name %>
        </td>
        <td>
          <input class="away-score" type="number" value='<%= (game.score) ? game.score.home : 0 %>'/>
        </td>
        <td>
          <button class="score-submit" data-game-id="<%= game.id %>">Submit</button>
        </td>
        <td class="score-status"></td>
      </tr>
    <% end %>
  </tbody>
</table>

<script type="text/javascript">
  $(".score-submit").on("click", function() {
    console.log("clicked");
    var game_id = $(this).data("game-id");
    var home = $("#score-"+game_id).find(".home-score").val();
    var away = $("#score-"+game_id).find(".away-score").val();
    $.post(
      "/scores",
      {
        game_id: game_id,
        home: home,
        away: away,
        authenticity_token: "<%= form_authenticity_token %>"
      },
      function(data) {
        console.log(data);
      },
      "json"
    );
  });
</script>