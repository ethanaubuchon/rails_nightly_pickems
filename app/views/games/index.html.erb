<h1>Games</h1>

<%= render partial: "shared/datepicker", locals: {date: @date, path: @path} %>

<table class="table">
  <thead>
    <tr>
      <th>Game time</th>
      <th colspan="4"></th>
      <th>Pick</th>
    </tr>
  </thead>

  <tbody>
    <% @games.each do |game| %>
      <tr class="game-row">
        <td><%= game.game_time.in_time_zone("Eastern Time (US & Canada)").strftime("%I:%M%p") %></td>
        <td>
          <button class="pick-team-link" <%= "disabled" if game.started? %> data-gameteamid=<%= game.away_game_team.id %>>
            <%= game.away_team.fullname.titleize %>
          </button>
        </td>
        <td> @ <td>
        <td>
          <button class="pick-team-link" <%= "disabled" if game.started? %> data-gameteamid=<%= game.home_game_team.id %>>
            <%= game.home_team.fullname.titleize %>
          </button>
        </td>
        <% if pick = game.get_user_pick(current_user) %>
          <td class="message">You picked the team <%= pick.game_team.team.name.titleize %>!</td>
        <% elsif game.started? %>
          <td class="message">You missed the game start time. No pick for you!</td>
        <% else %>
            <td class="message"></td>
        <% end %>
      </tr>
    <% end %>
  </tbody>
</table>

<br>

<script>
  var token = "<%= form_authenticity_token %>";
  $(".pick-team-link").on("click", function() {
    if ($(this).attr("disabled") == "disabled") {
      return;
    }
    var row = $(this).parents(".game-row");
    var game_team_id = $(this).data("gameteamid");
    $.post( 
      "/picks", 
      { 
        game_team_id: game_team_id,
        authenticity_token: "<%= form_authenticity_token %>"
      }, function( data ) {
        row.find("td.message").text(data.message)
      }, "json");
  });
</script>
